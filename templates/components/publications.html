{% from 'share-modal.html' import shareModal %}
{% for publication in results.publications %}
<div class="card mb-2 p-3">
    <div class="card-body">
        <div class="row">
            <div class="col-11 fs-6">
                <div class="row mb-2">
                    <div class="col-9 fs-6">
                        {% if publication.identifier == '' %}
                        <span class="text-secondary fw-bold publication_name">
                            {{publication.name}}</span>
                        {% else %}
                        <a class="text-secondary fw-bold publication_name"
                            href='/publication-details/{{publication | format_digital_obj_url}}'
                            target='_blank'>{{publication.name}}</a>
                        {% endif %}
                    </div>
                    <div class="col-3 text-end ">
                        <span
                            class="badge bg-pill bg-success text-wrap text-break">DOI:{{publication.identifier}}</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-9 my-2 authors">
                        {% set author_count = namespace(value=0) %}
                        {% for author in publication.author %}
                        {% if author_count.value == 5 %}
                        <a href="#" class="tag_more_authors">and {{ (publication.author|count) - 5 }}
                            more</a>
                        {% endif %}
                        {% if author.type == 'Person' %}
                        <a href="{{author.identifier}}"
                            class="{% if author_count.value > 4 %}d-none{% endif %} btn btn-outline-dark text-dark rounded-pill border-1 p-1 pe-2 mb-1"
                            tabindex="-1" role="button" aria-disabled="true"><i
                                class="ps-1 pe-1 bi-person-circle"></i>{{author.name}}</a>
                        {% endif %}
                        {% set author_count.value = author_count.value + 1 %}
                        {% endfor %}
                    </div>
                    <div class="col-3 text-end ">
                        <!-- <span
                            class="badge bg-pill bg-success text-wrap text-break">Score:{{publication.rankScore}}</span> -->
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <p class="card-text">{{publication.description|truncate(500)}}</p>
                    </div>
                </div>
                <div class="row pt-3">
                    <div class="col-9 text-start">
                        {% for source in publication.source %}
                        <a id="source_link" href="{{source.url}}" target=_blank>
                            <span class="badge bg-pill text-wrap text-break">{{source.name}}</span>
                        </a>
                        {% endfor %}
                        <span
                            class="badge bg-pill bg-secondary text-wrap text-break">{{publication.originalSource}}</span>
                    </div>
                    <div class="col-3 text-end">
                        <span class="badge bg-pill text-wrap text-break">{{publication.publication}}</span>
                        <span class="badge bg-pill text-wrap text-break">{{publication.datePublished}}</span>
                    </div>
                </div>
            </div>
            <div class="col-1">
                <div class="row fs-5">
                    <!-- <div class="col-lg-12 text-end mb-3"><a target='_blank' href="#" title="bookmark"><i
                                                class="bi bi-bookmark"></i></a></div> -->
                    {% if publication.identifier != '' %}
                    <div class="text-end mb-3"><a href="#" title="Share" class="share_modal_link" data-bs-toggle="modal"
                            data-bs-target="#share_modal_dialog"><i class="bi bi-share"></i></a></div>
                    {% endif %}
                    {% if publication.image != '' %}
                    <div class="text-end mb-3"><a href="#" title="Preview" class="preview_modal_link"
                            data-bs-toggle="modal" data-bs-target="#preview_modal_dialog"
                            data-bs-publ-name="{{publication.name}}" data-bs-img-src="{{publication.image}}"><i
                                class="bi bi-eye"></i></a>
                    </div>
                    {% endif %}
                    {% if publication.encoding_contentUrl != '' %}
                    <div class="text-end mb-3"><a href="#" title="Download" class="download_modal_link"
                            data-bs-toggle="modal" data-bs-target="#download_modal_dialog"
                            data-bs-publ-name="{{publication.name}}"
                            data-bs-embed-src="{{publication.encoding_contentUrl}}"><i class="bi bi-download"></i></a>
                    </div>
                    {% endif %}
                </div>
            </div>

            {{ shareModal(publication.url) }}

            <div id="preview_modal_dialog" class="modal">
                <div class="modal-dialog modal-dialog-scrollable" style="max-width : 1200px;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="" class="figure-img img-fluid border border-dark">
                            <figcaption>
                            </figcaption>
                        </div>
                    </div>
                </div>
            </div>

            <div id="download_modal_dialog" class="modal">
                <div class="modal-dialog modal-dialog-scrollable" style="max-width : 1200px;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-center">
                            <iframe src="" width="1150px" height="800px"></iframe>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endfor %}

<div id="div_load_more_publications" class="row text-center my-2">
    <div class="col">
        {% if session.displayed_search_results.publications < session.total_search_results.publications %} <div>
            Displaying top {{session.displayed_search_results.publications }} publications out of {{
            session.total_search_results.publications }}
    </div>
    <br />
    <button type="button" class="btn btn-secondary" aria-label="Load more publications"
        id="btn_load_more_publications">Load more publications</button>
    {% endif %}
</div>
</div>